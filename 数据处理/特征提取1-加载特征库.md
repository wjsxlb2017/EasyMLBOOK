# 说明

时序特征库是一种对时间序列数据进行特征提取的方法。针对异常检测场景,我们提供了常用的函数，用户通过选择函数名，就可以完成相应的特征提取操作。

# 参数

特征库包括以下几种函数：

| 特征名                 | 特征中文名              | 特征描述                                                   |
|---------------------|--------------------|--------------------------------------------------------|
| diff2               | 二阶差分               | 二阶差分                                                   |
| bk_ts_diff          | 一阶差分               | 一阶差分                                                   |
| bk_ts_ewma          | 基于指数加权平均的异常得分      | 使用ewma作为预测值，对比预测值和真实值之间的大小，计算异常得分                      |
| bk_ts_ewmstd        | 基于指数加权平均归一化之后的异常得分 | 使用ewma作为预测值，ewmstd作为置信区间，计算异常得分，计算最后一个点的z_score，作为异常程度 |
| bk_ts_slope_ratio   | 最近两个窗口的斜率比         | 计算最近两个窗口的斜率的比值                                         |
| bk_ts_sum_ratio     | 最近两个窗口的积分比         | 计算最近两个窗口的积分的比值                                         |
| bk_ts_crossingpoint | 是否为交叉点             | 计算是否是局部拐点，比较最近一段曲线 和 倒数第二段曲线的方向是否一致                    |
| bk_ts_changepoint   | 突变得分               | 计算窗口最近一个点的增长率/斜率                                       |


# 输入输出预览

输入数据预览如下：

| timestamp     | value | label |
|---------------|-------|-------|
| 2017/8/6 0:00 | 65013 | 0     |
| 2017/8/6 0:01 | 64492 | 0     |
| 2017/8/6 0:02 | 64058 | 0     |
| 2017/8/6 0:03 | 63587 | 0     |
| 2017/8/6 0:04 | 63085 | 0     |


经过加载特征库之后的输出数据预览如下：

| timestamp           | value | label | bk_ts_diff | bk_ts_ewma         | bk_ts_ewmstd       | bk_ts_slope_ratio  | bk_ts_sum_ratio    | bk_ts_crossingpoint | bk_ts_changepoint     |
|---------------------|-------|-------|------------|--------------------|--------------------|--------------------|--------------------|---------------------|-----------------------|
| 2017-08-06 00:00:00 | 65013 | 0     |            |                    |                    | -inf               | -inf               | 0                   | -inf                  |
| 2017-08-06 00:01:00 | 64492 | 0     |            |                    |                    | -inf               | -inf               | 0                   | -inf                  |
| 2017-08-06 00:02:00 | 64058 | 0     |            |                    |                    | -inf               | -inf               | 0                   | -inf                  |
| 2017-08-06 00:03:00 | 63587 | 0     |            |                    |                    | -inf               | -inf               | 0                   | -inf                  |
| 2017-08-06 00:04:00 | 63085 | 0     |            |                    |                    | -inf               | -inf               | 0                   | -inf                  |
| 2017-08-06 00:05:00 | 62548 | 0     |            |                    |                    | -inf               | -inf               | 0                   | -inf                  |
| 2017-08-06 00:06:00 | 62007 | 0     |            |                    |                    | -inf               | -inf               | 0                   | -inf                  |
| 2017-08-06 00:07:00 | 61612 | 0     |            |                    |                    | -inf               | -inf               | 0                   | -inf                  |
| 2017-08-06 00:08:00 | 61059 | 0     |            |                    |                    | -inf               | -inf               | 0                   | -inf                  |
| 2017-08-06 00:09:00 | 60487 | 0     | -572       | 61021.55718475073  | 878.3724478544066  | 0.9906320116608526 | 0.9920241214814762 | 0                   | -0.009367988339147383 |
| 2017-08-06 00:10:00 | 60035 | 0     | -452       | 60525.84555229716  | 858.208430266632   | 0.9925273199199828 | 0.9920825672590974 | 0                   | -0.007472680080017194 |
| 2017-08-06 00:11:00 | 59468 | 0     | -567       | 59994.46725317693  | 879.5900141173184  | 0.9905555092862497 | 0.9917812339966838 | 0                   | -0.009444490713750312 |
| 2017-08-06 00:12:00 | 58815 | 0     | -653       | 59402.17106549365  | 945.189743526359   | 0.989019304499899  | 0.991384539834768  | 0                   | -0.010980695500100895 |
| 2017-08-06 00:13:00 | 58148 | 0     | -667       | 58772.427174975564 | 1010.1530989187673 | 0.9886593556065629 | 0.9910091856729726 | 0                   | -0.011340644393437049 |
| 2017-08-06 00:14:00 | 57525 | 0     | -623       | 58145.99608993157  | 1037.6397107151263 | 0.9892859599642292 | 0.990769581332613  | 0                   | -0.010714040035770792 |
| 2017-08-06 00:15:00 | 56956 | 0     | -569       | 57548.264907135876 | 1025.5856366281516 | 0.9901086484137331 | 0.9906316539183464 | 0                   | -0.00989135158626684  |
| 2017-08-06 00:16:00 | 56338 | 0     | -618       | 56940.36168132942  | 1028.186492839503  | 0.989149518926891  | 0.9901255371134889 | 0                   | -0.010850481073109066 |
| 2017-08-06 00:17:00 | 55702 | 0     | -636       | 56318.292277614855 | 1041.129186878623  | 0.9887109943554971 | 0.9898701097325989 | 0                   | -0.011289005644502822 |

