
# Scaler

## **算法说明**

  Scaler模块集成了最大最小值归一化（MinMaxScaler）和标准化（StandardScaler）两种方式，用户可通过特征配置文件来指定某个特征的归一化方法。下面分别介绍这两种方法：

  MinMaxScaler算法对特征数据进行统一的归一化处理，默认归一化后的特征数值范围在[0,1]，用户也可以指定归一化后的取值范围为[min,max]。 该归一化的计算公式为：

  $$((x-EMin)/(EMax-EMin))*(max-min)+min$$

  其中x表示需要归一化的特征值，EMin表示该特征下的最小值，EMax表示该特征下的最大值，min与max为用户设定的归一化后的数值范围。注意，当某列特征的最大最小值相等时，该列所有数值归一化为0.5*(max - min) + min。

  StandardScaler算法主要对特征进行标准化处理，原始特征数据通过该算法的转化将成为方差为1，均值为0的新的特征。计算公式为：

  $$\frac{((x-Mean)}{Var}$$

  其中，Mean代表该特征的平均值，Var表示该特征的样本标准差。以下的特殊情况应该**注意**:

  (1)如果Var为0，则x标准化后的结果直接为0.0

  (2)不需要均值化处理：此时算法只做方差处理，即：x/Var

  (3)不需要方差处理:x直接取值(x-Mean)

  (4)首次使用该模块，算法内部会将特征转换的如下五个内容保存在HDFS路径中，这些内容分别是：特征的Id,是否需要做均值的标准化，是否需要做方差的标准化，特征的均值，特征的方差。当再次使用该模块时，算法将直接使用该HDFS路径中的上述配置进行转换，用户无需再填写配置文件。若不提供HDFS路径，则不会保存上述的内容。

- [**jarvis样例**](http://tesla.oa.com/ml/platform.html?projectId=10002&flowId=2209)

##  **输入**

  - 数据形式：[Dense](http://tesla.oa.com/gitbook/doc/javis/tdw_ml_jarvis_dataformat.html#21-dense%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F)
  - 格式：| 参与计算的features | 不参与计算的features |
  - 参与计算的features：通过**特征配置文件**指定
  - 不参与计算的features：可包括不参与计算的特征，如果存在则保留在输出中

## **输出**

  - 格式：与输入数据格式一致
  - 说明：特征排列顺序与输入数据的一致，根据特征配置对数据进行归一化或标准化处理，没有配置的特征值保持不变

## **参数**

  - 并行数：训练数据的分区数、spark的并行数
  - 抽样率：输入数据的采样率
  - 特征标准化的保存路径：用于保存特征标准化的配置信息，方便以后直接使用该配置做转换，不填的情况下特征配置信息将不会被保存
 - "method": “minmax"和"standard"分别代表了相应的归一化模块MinMaxScaler和StandardScaler
  - "colStr":需要做相应处理的特征id,取值根据该特征在原始表的所在列，从0开始计数。多个特征可用","隔开，还可用"-"标识特征的起始到结束列，例如"1-20"表示第1列到第20列。
  - "min":归一化后的最小值
  - "max":归一化后的最大值
  - "std":是否需要做方差的标准化
  - "mean":是否需要做均值的标准化

```json
{
    "minmax":[
      {
        "colStr": "1-2",
        "min": "0",
        "max":"1"
      },
      {
        "colStr":"5",
        "min":"-1",
        "max": "1"
       }
       ],
        "standard":[
       {
        "colStr": "3,6-7",
        "std": "true",
        "mean":"false"
       },
       {
        "colStr": "8,9",
        "std":"true",
        "mean":"true"
       }
       ]
}
```

